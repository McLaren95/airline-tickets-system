{% extends 'base.html' %}
{% load static %}

{% block title %}Поиск рейсов - SkyTickets{% endblock %}

{% block content %}
    <h1 style="margin-bottom: 30px;"><i class="fas fa-search"></i> Поиск рейсов</h1>

    <div class="card">
        <form method="get" action="{% url 'flight_search' %}">
            <div class="form-row">
                <div class="form-group">
                    <label for="departure"><i class="fas fa-plane-departure"></i> Откуда</label>
                    <input type="text" id="departure" name="departure" class="form-control" 
                           placeholder="Москва (SVO)" value="{{ request.GET.departure }}">
                </div>
                
                <div class="form-group">
                    <label for="arrival"><i class="fas fa-plane-arrival"></i> Куда</label>
                    <input type="text" id="arrival" name="arrival" class="form-control" 
                           placeholder="Санкт-Петербург (LED)" value="{{ request.GET.arrival }}">
                </div>
                
                <div class="form-group">
                    <label for="date"><i class="fas fa-calendar-alt"></i> Дата вылета</label>
                    <input type="date" id="date" name="date" class="form-control" 
                           value="{{ request.GET.date }}">
                </div>
            </div>
            
            <button type="submit" class="btn" style="width: 100%;">
                <i class="fas fa-search"></i> Найти рейсы
            </button>
        </form>
    </div>

    {% if flights %}
        <div class="results">
            <h3 style="margin: 30px 0 20px 0;">
                <i class="fas fa-plane"></i> Найдено рейсов: {{ flights|length }}
            </h3>
            
            {% for flight in flights %}
                <div class="card" style="margin-bottom: 20px; border-left: 4px solid #007bff;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <h4 style="margin: 0 0 10px 0;">
                                {{ flight.route.departure_airport.airport_code }} → 
                                {{ flight.route.arrival_airport.airport_code }}
                            </h4>
                            <p style="margin: 5px 0;">
                                <i class="far fa-calendar"></i> 
                                {{ flight.scheduled_departure|date:"d.m.Y H:i" }}
                            </p>
                            <p style="margin: 5px 0;">
                                <i class="fas fa-clock"></i> 
                                В пути: {{ flight.route.duration }}
                            </p>
                            <p style="margin: 5px 0;">
                                <span class="status-badge 
                                    {% if flight.status == 'Scheduled' %}status-scheduled
                                    {% elif flight.status == 'Delayed' %}status-delayed
                                    {% elif flight.status == 'Departed' %}status-departed
                                    {% else %}status-arrived{% endif %}">
                                    {{ flight.get_status_display }}
                                </span>
                            </p>
                        </div>
                        
                        <div style="text-align: right;">
                            <div style="font-size: 1.5rem; font-weight: bold; color: #28a745;">
                                5 500 ₽
                            </div>
                            <p style="margin: 10px 0 0 0;">Самолет: {{ flight.route.airplane.airplane_code }}</p>
                            
                            {% if user.is_authenticated %}
                                <a href="{% url 'book_flight' flight.flight_id %}" class="btn" 
                                   style="margin-top: 15px;">
                                    <i class="fas fa-ticket-alt"></i> Забронировать
                                </a>
                            {% else %}
                                <a href="{% url 'login' %}?next={% url 'book_flight' flight.flight_id %}" 
                                   class="btn" style="margin-top: 15px;">
                                    <i class="fas fa-sign-in-alt"></i> Войти для бронирования
                                </a>
                            {% endif %}
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% elif request.GET %}
        <div class="card" style="text-align: center; padding: 40px;">
            <i class="fas fa-plane-slash" style="font-size: 4rem; color: #6c757d; margin-bottom: 20px;"></i>
            <h3>Рейсы не найдены</h3>
            <p>Попробуйте изменить параметры поиска</p>
        </div>
    {% endif %}
{% endblock %}

{% block scripts %}
<style>
.status-badge {
    display: inline-block;
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 0.9rem;
    font-weight: bold;
}
.status-scheduled { background: #d4edda; color: #155724; }
.status-delayed { background: #fff3cd; color: #856404; }
.status-departed { background: #cce5ff; color: #004085; }
.status-arrived { background: #d1ecf1; color: #0c5460; }
</style>
{% endblock %}